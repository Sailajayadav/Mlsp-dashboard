<!-- dashboard.html -->
<!DOCTYPE html>
<html>
<head>
    <title>MLS Point Dashboard</title>
</head>
<body>
    <h2>Select District and Mandal</h2>
   <form id="mls-form">
    <label>District:</label>
    <select id="district" required>
        <option value="">Select District</option>
    </select>
    <label>Mandal:</label>
    <select id="mandal" required>
        <option value="">Select Mandal</option>
    </select>
    <button type="submit" id="submit-btn">Submit</button>
</form>
    <div id="result"></div>

    <script>
    // Fetch districts on page load
    fetch('/api/districts')
        .then(res => res.json())
        .then(data => {
            const districtSel = document.getElementById('district');
            data.forEach(d => {
                let opt = document.createElement('option');
                opt.value = d;
                opt.textContent = d;
                districtSel.appendChild(opt);
            });
        });

    // Fetch mandals when district changes
    document.getElementById('district').addEventListener('change', function() {
        const district = this.value;
        const mandalSel = document.getElementById('mandal');
        mandalSel.innerHTML = '<option value="">Select Mandal</option>';
        if (!district) return;
        fetch(`/api/mandals?district=${encodeURIComponent(district)}`)
            .then(res => res.json())
            .then(data => {
                data.forEach(m => {
                    let opt = document.createElement('option');
                    opt.value = m;
                    opt.textContent = m;
                    mandalSel.appendChild(opt);
                });
            });
    });

    // Handle form submission
    document.getElementById('mls-form').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent form reload
    const district = document.getElementById('district').value;
    const mandal = document.getElementById('mandal').value;
    if (!district || !mandal) return;
    fetch(`/api/mls_point_by_district_mandal?district=${encodeURIComponent(district)}&mandal=${encodeURIComponent(mandal)}`)
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                document.getElementById('result').textContent = data.error;
            } else {
                // Redirect to detail page or show info
                window.location.href = `/detail/${data.MLS_Point_Code}`;
            }
        });
});
</script>